# 概括

### 简要总体要求（Prose Notation）
> 下面规定了抽象语法树逐步执行每条指令的执行规则

+ 运行时必须提供一个Store
+ 运行时必须提供一个Stack，Stack可以push或者pop （values、label、frames）
+ Stack至少含有一个frames，最近的frames被称为当前frame
+ Store和当前frames可以被修改，这种修改是程序全局性的
+ 指令按顺序执行，除非发生trap或者jump
+ 可以从blocks中退出或者进入指令
+ 指令的执行也可能以跳转到指定目标而结束，该目标定义了下一条要执行的指令。
+ 在不同的地方，规则中包含了表达程序状态的关键不变性的断言

### Q&A

##### 什么是tarp

在WebAssembly（简称Wasm）中，"trap"（陷阱）是一种异常情况，类似于其他编程语言中的异常或错误。它是由Wasm虚拟机在执行Wasm模块时遇到的一种非正常情况。

当Wasm模块执行过程中出现一些无效或非法的操作时，虚拟机会触发陷阱。这些无效操作包括但不限于以下情况：

1. 除数为零：当Wasm代码尝试进行除法运算并且除数为零时，将引发陷阱。

2. 内存越界：当Wasm代码尝试访问超过已分配内存范围的内存位置时，将触发陷阱。

3. 无效指令：当Wasm代码包含无效或不支持的指令时，将导致陷阱。

4. 类型不匹配：当Wasm模块中的操作数类型不符合预期时，将引发陷阱。

当发生陷阱时，Wasm虚拟机会停止执行并抛出一个异常。这个异常可以被宿主环境（如浏览器）捕获和处理，从而防止程序崩溃或产生不可预期的结果。

陷阱是Wasm提供的一种安全机制，用于保护系统和应用免受恶意或错误的Wasm代码的影响。它帮助确保Wasm模块的执行在安全的边界内，提高了安全性和可靠性。

##### WASM运行时和Java虚拟机对比有哪些相似和不同

相同点：

1. WASM Store == JVM内存（除了Stack），包括funcs、table、memory、global、element（和table对应）、data（和memory对应）。
2. WASM Stack == JVM Stack（分为Java Stack 和 Native Method Stack）
3. funcs == JVM Method Area（方法区）
4. global == Run-Time Constant Pool（运行时常量池）
5. memory == JVM Heap（堆）
6. table == C++ 虚表 == Rust 虚函数 == Java 中所有方法都是虚函数，保存在JVM Method Area 中的 虚表

不同点：

1. Store不适合创建无限的Instance，应为没有gc
2. 每一个Store都是一个单独的虚拟机，WASM 有更强的隔离性
3. 在 WebAssembly（Wasm）执行环境中，每个线程（或者称之为实例）都会有一个调用栈（call stack）。
WebAssembly 是一种低级字节码，它在执行时需要被一个执行引擎解释或编译成本地代码。执行引擎负责将 WebAssembly 指令翻译成主机机器码并执行。

##### 什么是程序的关键性不变的断言

在计算机科学和软件工程中，"不变性"（invariant）是指在程序执行过程中始终保持不变的性质或条件。不变性是关于程序状态的某些属性或约束，它在程序的执行过程中始终成立。

在给定的规则或规范中，这些断言用于表达关键的不变性条件，以确保程序的正确性和可靠性。这些不变性条件通常是对程序状态、数据结构或执行过程的特定属性的要求。

这些断言可以用于验证程序的正确性，进行静态分析，或作为运行时检查的一部分。通过在规则中包含这些断言，可以对程序状态的特定方面进行验证，并确保程序在执行过程中满足关键的约束和条件。

断言的示例可能包括：

- 数据结构的完整性：确保数据结构在执行过程中的特定属性保持不变，例如链表中的指针关系、树的平衡性等。
- 前置条件和后置条件：定义函数或方法的输入和输出之间的关系，例如函数在接收有效参数时返回有效结果。
- 循环不变式：在循环执行过程中，指定在每次迭代之间保持不变的条件，以确保循环的正确性。
- 程序状态的约束：对于特定的状态变量，指定其具有的属性或范围，以确保程序在执行过程中满足这些约束。

通过在规则中包含这些关键不变性的断言，可以提供关于程序行为和状态的重要信息，帮助程序员和分析工具在设计、实现和验证过程中维护和验证程序的正确性。